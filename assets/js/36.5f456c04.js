(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{625:function(t,s,a){"use strict";a.r(s);var e=a(5),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lemonnuu/PicGoPictureBed/markdown/webpack/0004-webpack%E5%AE%98%E7%BD%91%E5%9B%BE.png",alt:"0004-webpack官网图"}})]),t._v(" "),a("h2",{attrs:{id:"source-map"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#source-map"}},[t._v("#")]),t._v(" source map")]),t._v(" "),a("p",[t._v("✔️ "),a("strong",[t._v("当 webpack 打包源代码时, 可能会很难追踪到 error(错误) 和 warning(警告) 在源代码中的原始位置。")])]),t._v(" "),a("p",[t._v("例如, 如果将三个源文件("),a("code",[t._v("a.js")]),t._v(", "),a("code",[t._v("b.js")]),t._v(" 和 "),a("code",[t._v("c.js")]),t._v(") 打包到一个 bundle ("),a("code",[t._v("bundle.js")]),t._v(") 中, 而其中一个源文件包含一个错误, 那么堆栈跟踪就会直接指向到 "),a("code",[t._v("bundle.js")]),t._v("。\n但是, 我们往往需要准确的知道错误来自哪个源文件, 而不是这种无用的信息。")]),t._v(" "),a("p",[t._v("✔️ 为了更容易地追踪 error 和 warning, JavaScript 提供了source map 功能, 它实际上就是一个 vlq 编码的信息文件, 保存着源代码的映射关系。")]),t._v(" "),a("p",[t._v("webpack.config.js")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HtmlWebpackPlugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'html-webpack-plugin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("mode")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'development'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("entry")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./src/index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("devtool")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'source-map'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("output")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].bundle.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("clean")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"devtool"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#devtool"}},[t._v("#")]),t._v(" devtool")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"title"}),a("p",[t._v("✔️ development(开发) 模式下, source map是默认开启的, production(生产) 模式下, source map 是默认关闭的。")]),t._v(" "),a("p",[t._v("webpack5 的 "),a("code",[t._v("devtool")]),t._v(" 配置项已经不能配置为 "),a("code",[t._v("'none'")]),t._v(" 了, webpack4 可以采用此配置关闭 source map。")])]),a("p",[a("strong",[t._v("source map 有众多风格, 不同的值会明显影响到构建(build)和重新构建(rebuild)的速度。")])]),t._v(" "),a("p",[t._v("✔️ "),a("strong",[t._v("devtool 的风格模式可自由组合, 但不要混淆字符串的顺序: "),a("code",[t._v("[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map")])])]),t._v(" "),a("p",[t._v("⭕️ "),a("code",[t._v("source-map")]),t._v(" 会单独生成一个 "),a("code",[t._v(".js.map")]),t._v(" 文件, 用于储存与源代码的映射关系。")]),t._v(" "),a("p",[t._v("⭕️ "),a("code",[t._v("inline-*")]),t._v(" 不会单独生成文件, 而是以 base64 编码的形式写在 main.js 里头。")]),t._v(" "),a("p",[t._v("⭕️ "),a("code",[t._v("cheap-*")]),t._v(" 不会映射列, 只会映射行, 且不映射第三方库。")]),t._v(" "),a("p",[t._v("⭕️ "),a("code",[t._v("cheap-module-*")]),t._v(" module 必须搭配 cheap 使用, 在 cheap 的基础上映射第三方库代码。")]),t._v(" "),a("p",[t._v("⭕️ "),a("code",[t._v("eval")]),t._v(" 每个模块都使用 "),a("code",[t._v("eval()")]),t._v(" 执行, 且都有 "),a("code",[t._v("//@ sourceURL")]),t._v(", 此选项构建非常块! 但是, 映射的是转换后的代码, 而不是源代码。")]),t._v(" "),a("p",[t._v("⭕️ "),a("code",[t._v("eval-*")]),t._v(" 每个模块使用 "),a("code",[t._v("eval()")]),t._v(" 执行, 且会将 source map 转换为 DataUrl 后添加到 "),a("code",[t._v("eval()")]),t._v(" 中, 能够正确映射, 初始化时较慢, 但重新构建时速度较快。")]),t._v(" "),a("p",[t._v("⭕️ "),a("code",[t._v("hidden-*")]),t._v(" 与 "),a("code",[t._v("source-map")]),t._v(" 相同, 但不会为 bundle 添加引用注释, 也就是不会向浏览器暴露 source map。")]),t._v(" "),a("p",[t._v("⭕️ "),a("code",[t._v("nosources-*")]),t._v(" 创建的 source map 不包含 sourcesContent(源代码内容)。这只会暴露文件名和结构, 但不暴露原始代码。")]),t._v(" "),a("h2",{attrs:{id:"环境选择配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境选择配置"}},[t._v("#")]),t._v(" 环境选择配置")]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"title"},[t._v("生产环境下")]),a("p",[t._v("✔️ source map 文件不应该被部署到 web 服务器, 而只是将其用于错误报告工具, 且应该将服务器配置为：不允许普通用户访问 source map 文件!")]),t._v(" "),a("p",[a("code",[t._v("nosources-*")]),t._v(" 勉强可以部署到 web 服务器。")])]),a("h3",{attrs:{id:"生产环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生产环境"}},[t._v("#")]),t._v(" 生产环境")]),t._v(" "),a("p",[a("strong",[t._v("生产环境一般不生成 source map, 如果需要, 可以使用 "),a("code",[t._v("nosources-cheap-module-source-map")]),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"开发环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发环境"}},[t._v("#")]),t._v(" 开发环境")]),t._v(" "),a("p",[t._v("✔️ "),a("strong",[t._v("开发环境可以使用 "),a("code",[t._v("eval-cheap-module-source-map")]),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"特定场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#特定场景"}},[t._v("#")]),t._v(" 特定场景")]),t._v(" "),a("p",[t._v("针对一些第三方工具等特定场景, 可以使用 "),a("code",[t._v("inline-cheap-module-source-map")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"source-map-原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#source-map-原理"}},[t._v("#")]),t._v(" source map 原理")]),t._v(" "),a("p",[t._v("分析一下 source map 生成的 "),a("code",[t._v(".js.map")]),t._v(" 文件。")])])}),[],!1,null,null,null);s.default=r.exports}}]);