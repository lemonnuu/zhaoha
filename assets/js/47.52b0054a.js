(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{635:function(s,t,e){"use strict";e.r(t);var a=e(5),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lemonnuu/PicGoPictureBed/markdown/webpack/0004-webpack%E5%AE%98%E7%BD%91%E5%9B%BE.png",alt:"0004-webpack官网图"}})]),s._v(" "),e("p",[s._v("在了解浏览器缓存之前, 先来了解以下 manifest 是什么。")]),s._v(" "),e("p",[s._v("在使用 webpack 构建的典型应用程序中, 有三种主要的代码类型：")]),s._v(" "),e("ul",[e("li",[s._v("源码")]),s._v(" "),e("li",[s._v('源码依赖的任何第三方 "library" 或 "vendor"')]),s._v(" "),e("li",[s._v("webpack 的 runtime 和 manifest, 管理所有模块的交互")])]),s._v(" "),e("h2",{attrs:{id:"runtime"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#runtime"}},[s._v("#")]),s._v(" runtime")]),s._v(" "),e("p",[s._v("浏览器运行过程中, webpack 用来连接模块化应用程序所需的的所有代码")]),s._v(" "),e("ul",[e("li",[s._v("在模块交互时, 连接模块所需的加载和解析逻辑")]),s._v(" "),e("li",[s._v("已经加载到浏览器中的连接模块逻辑, 以及尚未加载模块的延时加载逻辑")])]),s._v(" "),e("h2",{attrs:{id:"manifest"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#manifest"}},[s._v("#")]),s._v(" manifest")]),s._v(" "),e("p",[s._v('当 compiler 开始执行、解析和映射应用程序时, 它会保留所有模块的详细要点, 这个数据集合成为 "manifest"。')]),s._v(" "),e("p",[s._v("通俗的讲, manifest 就是 chunk 之间的关系数据集合, 而runtime 会通过 manifest 来解析和加载模块。")]),s._v(" "),e("p",[s._v("无论选择哪种模块语法, 那些 "),e("code",[s._v("import")]),s._v(" 或 "),e("code",[s._v("require")]),s._v(" 语句都会转换为 "),e("code",[s._v("__webpack_require__")]),s._v(" 方法, 此方法指向模块标识符(module identifier)。")]),s._v(" "),e("p",[s._v("通过使用 manifest 中的数据, runtime 能够检索这些标识符, 找出每个标识符背后对应的模块。")]),s._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"title"}),e("p",[s._v("在 chunk 里, 注入了 runtime 和 manifest, 而注入的 runtime 和 manifest 在每次构建后都会发生变化 ❗️")])]),e("p",[s._v("通过 "),e("code",[s._v("WebpackManifestPlugin")]),s._v(" 插件, 可以将 manifest 数据提取为一个 JSON 文件以供使用。")]),s._v(" "),e("h2",{attrs:{id:"缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#缓存"}},[s._v("#")]),s._v(" 缓存")]),s._v(" "),e("p",[s._v("浏览器使用了一种名为缓存的技术, 通过命中缓存, 可以降低网络流量, 使网站加载速度更快。")]),s._v(" "),e("p",[s._v("然而, 如果我们在部署新版本时不更改资源的文件名, 浏览器可能会认为它没有被更新, 就会使用它的缓存版本。\n由于缓存的存在, 当需要获取新的代码时, 就会显得更棘手。")]),s._v(" "),e("p",[s._v("可以通过配置, 确保 webpack 编译生成的文件能够被客户端缓存, 而在文件内容变化后, 能够请求到新的文件。")]),s._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"title"}),e("p",[s._v("实际上就是当文件内容变化后, 编译生成不同的文件名即可。")])]),e("p",[s._v("将输出的文件名加入 "),e("code",[s._v("contenthash")]),s._v(" 即可。")]),s._v(" "),e("div",{staticClass:"language-js extra-class"},[e("div",{staticClass:"highlight-lines"},[e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("div",{staticClass:"highlighted"},[s._v(" ")]),e("div",{staticClass:"highlighted"},[s._v(" ")]),e("br"),e("br"),e("br"),e("br"),e("br")]),e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" HtmlWebpackPlugin "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'html-webpack-plugin'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmodule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("mode")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'development'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("entry")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./src/index.js'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("plugins")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HtmlWebpackPlugin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("output")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("filename")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[name]-[contenthash].js'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("chunkFilename")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[name]-[contenthash].js'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("path")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dist'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("clean")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"title"}),e("p",[s._v("在老版本的 webpack 中, 虽然文件没有被修改, 但是再次构建时, 文件名却会改变 ❗️")]),s._v(" "),e("p",[s._v("这是因为注入的 runtime 和 manifest 在每次构建后都会发生变化, 而这个被认为是 content 的一部分导致的。")]),s._v(" "),e("p",[s._v("输出结果和 webpack 版本有关, 新版本的就不会出现这样的问题, 但是仍然推荐提取引导模块和确定模块标识符, 确认结果可靠。")])]),e("h3",{attrs:{id:"提取引导模板"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#提取引导模板"}},[s._v("#")]),s._v(" 提取引导模板")]),s._v(" "),e("p",[e("code",[s._v("optimization.runtimeChunk")]),s._v(" 选项可以将 runtime 代码拆分为一个单独的 chunk。")]),s._v(" "),e("p",[s._v("将其设置为 "),e("code",[s._v("single")]),s._v(" 来为所有 chunk 创建一个 runtime bundle :")]),s._v(" "),e("p",[s._v("webpack.config.js")]),s._v(" "),e("div",{staticClass:"language-diff extra-class"},[e("pre",{pre:!0,attrs:{class:"language-diff"}},[e("code",[e("span",{pre:!0,attrs:{class:"token unchanged"}},[e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path')\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const HtmlWebpackPlugin = require('html-webpack-plugin')\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" \n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   mode: 'development',\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new HtmlWebpackPlugin()\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ],\n")])]),e("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[e("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   optimization: {\n")]),e("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     runtimeChunk: 'single',\n")]),e("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")])]),e("span",{pre:!0,attrs:{class:"token unchanged"}},[e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: '[name]-[contenthash].js',\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     chunkFilename: '[name]-[contenthash].js',\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve('dist'),\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     clean: true\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   }\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])])])])]),e("h3",{attrs:{id:"模块标识符"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#模块标识符"}},[s._v("#")]),s._v(" 模块标识符")]),s._v(" "),e("p",[s._v("如果添加或移除的依赖时, 模块标识符可能会发生改变。")]),s._v(" "),e("p",[s._v("每个 "),e("code",[s._v("module.id")]),s._v(" 会默认地基于解析顺序(resolve order)进行增量。也就是说, 当解析顺序发生变化, ID 也会随之变化。")]),s._v(" "),e("p",[s._v("当 "),e("code",[s._v("module.id")]),s._v(" 发生改变时, contenthash 也会随之改变, 可以将 "),e("code",[s._v("optimization.moduleIds")]),s._v(" 配置为确定性的("),e("code",[s._v("deterministic")]),s._v(")。")]),s._v(" "),e("p",[s._v("webpack.config.js")]),s._v(" "),e("div",{staticClass:"language-diff extra-class"},[e("pre",{pre:!0,attrs:{class:"language-diff"}},[e("code",[e("span",{pre:!0,attrs:{class:"token unchanged"}},[e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path')\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const HtmlWebpackPlugin = require('html-webpack-plugin')\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" \n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   mode: 'development',\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new HtmlWebpackPlugin()\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ],\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   optimization: {\n")])]),e("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[e("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     moduleIds: 'deterministic',\n")])]),e("span",{pre:!0,attrs:{class:"token unchanged"}},[e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     runtimeChunk: 'single',\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: '[name]-[contenthash].js',\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     chunkFilename: '[name]-[contenthash].js',\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve('dist'),\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     clean: true\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   }\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);